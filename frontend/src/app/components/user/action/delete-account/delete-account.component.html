<main class="page min-h-[80vh]">
  <section aria-labelledby="delete-title" class="card max-w-lg w-full text-center">
    <h1 id="delete-title" class="section-title">Suppression du compte</h1>

    <!-- Avertissement -->
    <div class="alert-warning mb-6">
      <p>
        Cette action est <span class="highlight">irréversible</span>.<br />
        Toutes tes données seront définitivement supprimées.<br />
        Si tu es sûr de vouloir continuer, tape <strong>"I want delete"</strong> ci-dessous.
      </p>
    </div>

    <!-- Étape 1 : confirmation -->
    <form (ngSubmit)="openPasswordModal()" #deleteForm="ngForm" class="space-y-6">
      <div class="text-left flex flex-col gap-2">
        <label for="confirmationText" class="label">Confirmation</label>
        <input
          type="text"
          id="confirmationText"
          name="confirmationText"
          [(ngModel)]="confirmationText"
          required
          placeholder='Tape "I want delete"'
          class="input mt-1"
        />
        <p *ngIf="confirmationText && confirmationText !== 'I want delete'" class="error-text">
          Le texte doit être exactement "I want delete".
        </p>
      </div>

      <!-- Bouton continuer -->
      <button
        type="submit"
        [disabled]="confirmationText !== 'I want delete'"
        class="btn-primary w-full py-3 font-bold"
      >
        Continuer
      </button>

      <!-- Retour -->
      <nav aria-label="Retour au profil" class="mt-3">
        <a routerLink="/profil" class="btn-text">← Annuler et retourner au profil</a>
      </nav>
    </form>
  </section>

  <!-- Étape 2 : modale -->
  <div *ngIf="showPasswordModal" class="modal-overlay">
    <div class="modal">
      <h2 class="modal-title">Confirmer la suppression</h2>
      <p class="modal-text">
        Pour confirmer la suppression de ton compte, entre ton mot de passe.
      </p>

      <!-- Champ mot de passe -->
      <input
        [type]="showPassword ? 'text' : 'password'"
        [(ngModel)]="password"
        name="password"
        placeholder="••••••••"
        class="input mb-3"
      />

      <!-- Toggle visibilité -->
      <button type="button" (click)="showPassword = !showPassword" class="btn-text text-sm mb-4">
        {{ showPassword ? 'Masquer' : 'Afficher' }}
      </button>

      <!-- Erreur -->
      <div *ngIf="error" class="alert-error mb-4">
        {{ error }}
      </div>

      <!-- Actions -->
      <div class="flex justify-between">
        <button type="button" (click)="closePasswordModal()" class="btn-outline p-2">
          Annuler
        </button>
        <button
          (click)="confirmDeletion()"
          [disabled]="!password"
          class="btn-danger"
        >
          Supprimer
        </button>
      </div>
    </div>
  </div>
</main>
