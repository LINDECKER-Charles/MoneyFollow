<main class="page min-h-[60vh]">
  <section aria-labelledby="password-change-title" class="card max-w-md w-full text-center">
    <h1 id="password-change-title" class="section-title">Modifier le mot de passe</h1>

    <!-- Message d’erreur -->
    <div *ngIf="error" class="alert-error text-center mb-4">
      {{ error }}
    </div>

    <!-- Formulaire -->
    <form (ngSubmit)="onSubmit()" #passwordForm="ngForm" class="space-y-5 text-left">

      <!-- Nouveau mot de passe -->
      <div class="relative">
        <label for="password" class="label">Nouveau mot de passe</label>
        <input
          [type]="showPassword ? 'text' : 'password'"
          id="password"
          name="password"
          [(ngModel)]="password"
          required
          minlength="8"
          placeholder="••••••••"
          class="input pr-10"
        />

        <button
          type="button"
          (click)="showPassword = !showPassword"
          class="input-icon"
          tabindex="-1"
          aria-label="Afficher ou masquer le mot de passe"
        >
          <ng-container *ngIf="!showPassword; else eyeOff">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7
                   -1.274 4.057-5.065 7-9.542 7 -4.477 0-8.268-2.943-9.542-7z" />
            </svg>
          </ng-container>
          <ng-template #eyeOff>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7
                   a10.05 10.05 0 011.563-3.029m4.47-2.695A9.973 9.973 0 0112 5
                   c4.477 0 8.268 2.943 9.542 7a9.956 9.956 0 01-4.48 5.106M15 12a3 3 0
                   11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 3l18 18" />
            </svg>
          </ng-template>
        </button>
      </div>

      <!-- Confirmation -->
      <div class="relative">
        <label for="confirmPassword" class="label">Confirmer le mot de passe</label>
        <input
          [type]="showConfirm ? 'text' : 'password'"
          id="confirmPassword"
          name="confirmPassword"
          [(ngModel)]="confirmPassword"
          required
          placeholder="••••••••"
          class="input pr-10"
        />

        <button
          type="button"
          (click)="showConfirm = !showConfirm"
          class="input-icon"
          tabindex="-1"
          aria-label="Afficher ou masquer la confirmation du mot de passe"
        >
          <ng-container *ngIf="!showConfirm; else eyeOffConfirm">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7
                   -1.274 4.057-5.065 7-9.542 7 -4.477 0-8.268-2.943-9.542-7z" />
            </svg>
          </ng-container>
          <ng-template #eyeOffConfirm>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7
                   a10.05 10.05 0 011.563-3.029m4.47-2.695A9.973 9.973 0 0112 5
                   c4.477 0 8.268 2.943 9.542 7a9.956 9.956 0 01-4.48 5.106M15 12a3 3 0
                   11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 3l18 18" />
            </svg>
          </ng-template>
        </button>
      </div>

      <!-- Erreur -->
      <p *ngIf="password && confirmPassword && password !== confirmPassword"
         class="error-text">
        Les mots de passe ne correspondent pas.
      </p>

      <!-- Bouton principal -->
      <button
        type="submit"
        [disabled]="passwordForm.invalid || password !== confirmPassword"
        class="btn-primary w-full py-2.5 font-bold"
      >
        Modifier le mot de passe
      </button>

      <!-- Retour -->
      <nav aria-label="Retour au profil" class="text-center mt-3">
        <a routerLink="/profil" class="btn-text">← Retour au profil</a>
      </nav>
    </form>
  </section>
</main>
